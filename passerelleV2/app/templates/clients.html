{% extends 'base.html' %} {% block title %}Liste des Clients{% endblock %} {%
block content %}
<h2>Liste des Clients</h2>
<table class="table table-striped" id="clientsTable">
  <thead>
    <tr>
      <th>IdClient</th>
      <th>Nom client</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for client in clients %}
    <tr>
      <td>{{ client.idClient }}</td>
      <td>{{ client.username }}</td>
      <td>
        <div class="btn-group" role="group">
          <button
            class="btn btn-info"
            data-toggle="collapse"
            data-target="#details{{ client.idClient }}"
          >
            D√©tails
          </button>

          <form
            class="delete-client-form"
            onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer ce client ?')"
            data-client-id="{{ client.idClient }}"
          >
            <input
              type="hidden"
              name="client_id"
              value="{{ client.idClient }}"
            />
            <button type="submit" class="btn btn-danger delete-btn">üóëÔ∏è</button>
          </form>
        </div>
      </td>
    </tr>
    <tr id="details{{ client.idClient }}" class="collapse">
      <td colspan="3">
        <table class="table table-striped">
          <thead>
            <th>LibPasserelle</th>
            <th>actions</th>
          </thead>
          <tbody>
            {% for passerelle in client.passerellesClient %}
            <tr>
              <td>{{ passerelle.LibPasserelle }}</td>
              <td>
                <form
                  id="deleteClientPasserelleForm"
                  onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cette passerelle ?')"
                >
                  <input
                    type="hidden"
                    name="idClient"
                    value="{{ passerelle.idClient }}"
                  />

                  <input
                    type="hidden"
                    name="IdPasserelle"
                    value="{{ passerelle.IdPasserelle }}"
                  />

                  <button type="submit" class="btn btn-danger">üóëÔ∏è</button>
                </form>
              </td>
            </tr>

            {% endfor %}
          </tbody>
        </table>
        <div>
          <a
            href="{{ url_for('client.form_connect_passerelle', idClient=client.idClient) }}"
            class="btn btn-primary"
            >connecter une passerelle
          </a>
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
  $(document).ready(function () {
    $(".delete-client-form").on("submit", function (e) {
      e.preventDefault(); // Emp√™che la soumission normale du formulaire

      var clientId = $(this).data("client-id"); // R√©cup√®re l'ID du client √† partir des donn√©es du formulaire
      var url = "/database/client/" + clientId; // Construit l'URL pour la requ√™te DELETE

      // Envoie une requ√™te AJAX
      $.ajax({
        url: url,
        type: "DELETE",
        success: function (result) {
          alert("Client supprim√© avec succ√®s");
          location.reload(); // Recharge la page pour refl√©ter les changements
        },
        error: function (xhr, status, error) {
          alert("Erreur lors de la suppression: " + xhr.responseText);
        },
      });
    });
  });

  $(document).ready(function () {
    $("form#deleteClientPasserelleForm").on("submit", function (e) {
      e.preventDefault(); // Emp√™che la soumission normale du formulaire

      var form = $(this); // Le formulaire qui a √©t√© soumis
      var idClient = form.find('input[name="idClient"]').val(); // R√©cup√®re l'ID du client
      var idPasserelle = form.find('input[name="IdPasserelle"]').val(); // R√©cup√®re l'ID de la passerelle
      var url = `/database/client_passerelle/${idClient}/${idPasserelle}`; // Construit l'URL pour la requ√™te DELETE

      // Envoie une requ√™te AJAX
      $.ajax({
        url: url,
        type: "DELETE",
        success: function (result) {
          alert("Client Passerelle supprim√© avec succ√®s");
          location.reload(); // Recharge la page pour refl√©ter les changements
        },
        error: function (xhr, status, error) {
          alert("Erreur lors de la suppression: " + xhr.responseText);
        },
      });
    });
  });
</script>

{% endblock %}
